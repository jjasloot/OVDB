@if (instancesDataSource.loading$ | async) {
<div class="spinner-container">
    <mat-spinner></mat-spinner>
</div>
}
<div class="mat-elevation-z8 container">
    <mat-form-field class="filter">
        <input matInput placeholder="{{ 'ROUTESLIST.SEARCH' | translate }}" #input />
    </mat-form-field>
    <div class="buttons desktop">
        <button mat-stroked-button (click)="clearSelection()" [disabled]="selectedInstanceIds.length === 0">
            {{ "ROUTESLIST.DESELECT" | translate }}
        </button>
        <button mat-stroked-button (click)="exportToTrainlog()" color="accent" [disabled]="!selectedInstanceIds.length">
            {{ "ROUTESLIST.EXPORTTOTRAINLOG" | translate }}
        </button>
    </div>
    <table mat-table [dataSource]="instancesDataSource" matSort matSortActive="date" matSortDirection="desc"
        matSortDisableClear>
        <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef>
                {{ "ROUTESLIST.SELECT" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
                <mat-checkbox [checked]="isInstanceChecked(element)"
                    (change)="toggleInstance(element, $event)"></mat-checkbox>
            </td>
        </ng-container>

        <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                {{ "ROUTESLIST.DATE" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
                {{
                (element.date)
                | date : "mediumDate" : undefined : currentLocale
                }}
            </td>
        </ng-container>

        <ng-container matColumnDef="time">
            <th mat-header-cell *matHeaderCellDef>
                {{ "ROUTEINSTANCES.TIMES" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
                {{ element.startTime | date : "shortTime" }} - {{ element.endTime | date : "shortTime" }}
            </td>
        </ng-container>

        <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                {{ "ROUTESLIST.NAME" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
                <b>{{ element.routeName }} </b>
            </td>
        </ng-container>

        <ng-container matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                {{ "ROUTESLIST.TYPE" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
                @if (element.routeTypeColour) {
                <mat-chip-listbox>
                    <mat-chip-option [color]="element.routeTypeColour" [style.background]="element.routeTypeColour"
                        [selectable]="false">
                        {{ name(element.routeType) }}
                    </mat-chip-option>
                </mat-chip-listbox>
                }
            </td>
        </ng-container>

        <ng-container matColumnDef="from">
            <th mat-header-cell *matHeaderCellDef>
                {{ "FROM" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
                {{ element.from }}
            </td>
        </ng-container>

        <ng-container matColumnDef="to">
            <th mat-header-cell *matHeaderCellDef>
                {{ "TO" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
                {{ element.to }}
            </td>
        </ng-container>

        <ng-container matColumnDef="distance">
            <th mat-header-cell *matHeaderCellDef>
                {{ "ROUTES.DISTANCE" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
                {{ element.distance | number : "1.0-0" }} km
            </td>
        </ng-container>

        <ng-container matColumnDef="edit" stickyEnd>
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let element">
                <button class="desktop" mat-icon-button matTooltip="{{ 'HOME.VIEW' | translate }}"
                    (click)="view(element)">
                    <mat-icon>pageview</mat-icon>
                </button>
                <button class="desktop" mat-icon-button color="primary" matTooltip="{{ 'EDIT' | translate }}"
                    (click)="edit(element)">
                    <mat-icon>create</mat-icon>
                </button>
                <button class="mobile" mat-icon-button (click)="openBottomSheet(element)">
                    <mat-icon>reorder</mat-icon>
                </button>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator [length]="count" [pageSize]="10" [pageSizeOptions]="[10, 20, 50, 100]" [showFirstLastButtons]="true">
    </mat-paginator>
    <div class="buttons">
        <button mat-stroked-button (click)="clearSelection()" [disabled]="selectedInstanceIds.length === 0">
            {{ "ROUTESLIST.DESELECT" | translate }}
        </button>
        <button mat-stroked-button (click)="exportToTrainlog()" color="accent" [disabled]="!selectedInstanceIds.length">
            {{ "ROUTESLIST.EXPORTTOTRAINLOG" | translate }}
        </button>
    </div>
</div>