<div class="traewelling-container">
  @if (loading) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <span>{{ 'TRAEWELLING.LOADING_TRIPS' | translate }}</span>
    </div>
  } @else if (!connectionStatus?.connected) {
    <div class="not-connected">
      <mat-card>
        <mat-card-header>
          <mat-card-title>{{ 'TRAEWELLING.TITLE' | translate }}</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="not-connected-content">
            <mat-icon>link_off</mat-icon>
            <p>{{ 'PROFILE.TRAEWELLING_NOT_CONNECTED' | translate }}</p>
            <button mat-raised-button color="primary" (click)="router.navigate(['/profile'])">
              <mat-icon>arrow_back</mat-icon>
              {{ 'BACK' | translate }}
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  } @else {
    <h1>{{ 'TRAEWELLING.TITLE' | translate }}</h1>
    
    <!-- Actions Card -->
    <mat-card class="actions-card">
      <mat-card-content>
        <div class="actions-header">
          <mat-card-title>{{ 'TRAEWELLING.UNIMPORTED_TRIPS' | translate }}</mat-card-title>
          <button mat-raised-button color="primary" (click)="refreshTrips()" [disabled]="tripsLoading">
            <mat-icon>refresh</mat-icon>
            {{ 'TRAEWELLING.REFRESH' | translate }}
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    @if (tripsLoading) {
      <div class="loading-container">
        <mat-spinner></mat-spinner>
        <span>{{ 'TRAEWELLING.LOADING_TRIPS' | translate }}</span>
      </div>
    } @else if (unimportedTrips.length === 0) {
      <mat-card class="no-trips-card">
        <mat-card-content>
          <div class="no-trips-content">
            <mat-icon>check_circle</mat-icon>
            <h3>{{ 'TRAEWELLING.NO_TRIPS' | translate }}</h3>
            <p>{{ 'TRAEWELLING.NO_UNIMPORTED_TRIPS_MESSAGE' | translate }}</p>
          </div>
        </mat-card-content>
      </mat-card>
      
      @if (hasMorePages) {
        <div class="load-more-container">
          @if (loadingMore) {
            <div class="loading-container">
              <mat-spinner diameter="30"></mat-spinner>
              <span>{{ 'TRAEWELLING.LOADING_MORE_TRIPS' | translate }}</span>
            </div>
          } @else {
            <button mat-raised-button (click)="loadMoreTrips()" [disabled]="tripsLoading">
              <mat-icon>more_horiz</mat-icon>
              {{ 'TRAEWELLING.LOAD_MORE' | translate }}
            </button>
          }
        </div>
      }
    } @else {
      <div class="trips-list">
        @for (trip of unimportedTrips; track trip.id) {
          <app-trip-card 
            [trip]="trip"
            [showRouteInstances]="searchTrip?.id === trip.id"
            [searchingRouteInstances]="searchingRouteInstances"
            [routeInstances]="existingRouteInstances"
            (addToExistingRoute)="addToExistingRoute($event)"
            (createNewRoute)="createNewRoute($event)"
            (searchRouteInstances)="searchExistingRoutes($event)"
            (ignoreTrip)="ignoreTrip($event)"
            (linkToRouteInstance)="linkToExistingRouteInstance($event.trip, $event.routeInstance)">
          </app-trip-card>
        }
      </div>

      <!-- Pagination -->
      @if (hasMorePages) {
        <div class="load-more-container">
          @if (loadingMore) {
            <div class="loading-container">
              <mat-spinner diameter="30"></mat-spinner>
              <span>{{ 'TRAEWELLING.LOADING_MORE_TRIPS' | translate }}</span>
            </div>
          } @else {
            <button mat-raised-button color="primary" (click)="loadMoreTrips()" [disabled]="tripsLoading">
              <mat-icon>more_horiz</mat-icon>
              {{ 'TRAEWELLING.LOAD_MORE' | translate }}
            </button>
          }
        </div>
      }
    }
  }
</div>